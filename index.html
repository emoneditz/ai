<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AI Model Hub</title>
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <style>
        /* --- CSS STYLES --- */
        :root {
            --bg-body: #212121;
            --bg-sidebar: #171717;
            --bg-msg-ai: #444654;
            --bg-msg-user: #212121;
            --input-bg: #2f2f2f;
            --border: #424242;
            --text-main: #ececec;
            --text-muted: #b4b4b4;
            --green: #19c37d;
            --code-bg: #0d0d0d;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body {
            margin: 0; padding: 0;
            height: 100dvh; width: 100vw;
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            position: fixed; top: 0; left: 0; bottom: 0;
            width: 280px;
            background-color: var(--bg-sidebar);
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
            display: flex; flex-direction: column;
            border-right: 1px solid #333;
            box-shadow: 2px 0 10px rgba(0,0,0,0.5);
        }
        .sidebar.open { transform: translateX(0); }

        .overlay {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.6);
            z-index: 90; display: none;
            backdrop-filter: blur(2px);
        }
        .overlay.active { display: block; }

        .sidebar-header { padding: 20px; font-weight: bold; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .model-list { flex: 1; overflow-y: auto; padding: 10px; }
        
        .model-btn {
            display: flex; justify-content: space-between; align-items: center;
            width: 100%; padding: 14px;
            background: transparent; border: none;
            color: var(--text-muted); text-align: left;
            border-radius: 8px; cursor: pointer;
            margin-bottom: 4px; font-size: 14px;
            transition: 0.2s;
        }
        .model-btn:hover { background-color: #2a2a2a; color: white; }
        .model-btn.active { background-color: #343541; color: white; font-weight: 500; border: 1px solid #444; }
        
        .tag { font-size: 10px; padding: 3px 6px; border-radius: 4px; font-weight: bold; letter-spacing: 0.5px; }
        .tag.text { background: #333; color: #aaa; }
        .tag.img { background: linear-gradient(135deg, #a855f7, #ec4899); color: white; }

        /* MAIN VIEW */
        .main-view { flex: 1; display: flex; flex-direction: column; height: 100%; width: 100%; position: relative; }

        .top-bar {
            height: 50px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; background-color: var(--bg-body);
            border-bottom: 1px solid var(--border); flex-shrink: 0;
        }
        .hamburger { background: none; border: none; color: white; cursor: pointer; padding: 5px; display: flex; }
        
        /* CHAT AREA */
        .chat-container {
            flex: 1; overflow-y: auto; padding-bottom: 20px;
            display: flex; flex-direction: column;
            scroll-behavior: smooth;
        }

        .message {
            display: flex; padding: 24px 15px; gap: 15px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            font-size: 15px; line-height: 1.6;
            position: relative;
        }
        .message.assistant { background-color: var(--bg-msg-ai); }
        .message.user { background-color: var(--bg-msg-user); }

        .avatar {
            width: 30px; height: 30px; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; font-size: 18px;
        }
        .assistant .avatar { background: var(--green); }
        .user .avatar { background: #5436DA; color: white; font-size: 14px; }

        .content { flex: 1; overflow-x: hidden; word-break: break-word; }
        .content img { max-width: 100%; border-radius: 8px; margin-top: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .content p { margin-top: 0; }

        /* Actions (Copy) */
        .msg-actions {
            position: absolute; bottom: 10px; right: 10px;
            display: flex; gap: 5px; opacity: 0.5; transition: 0.2s;
        }
        .message:hover .msg-actions { opacity: 1; }
        .action-btn {
            background: transparent; border: none; color: #ccc;
            cursor: pointer; padding: 4px; border-radius: 4px;
        }
        .action-btn:hover { background: rgba(255,255,255,0.1); }

        /* Code Blocks */
        pre {
            background: var(--code-bg); padding: 0;
            border-radius: 6px; overflow: hidden;
            margin: 15px 0; border: 1px solid #333;
        }
        .code-header {
            display: flex; justify-content: space-between; align-items: center;
            background: #343541; padding: 5px 10px;
            font-size: 12px; color: #bbb; border-bottom: 1px solid #333;
        }
        .copy-code-btn {
            background: none; border: none; color: #bbb;
            cursor: pointer; display: flex; align-items: center; gap: 4px;
            font-size: 11px;
        }
        .copy-code-btn:hover { color: white; }
        pre code { padding: 15px; display: block; overflow-x: auto; }

        /* INPUT AREA */
        .input-area {
            background-color: var(--bg-body); border-top: 1px solid var(--border);
            flex-shrink: 0; padding: 10px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
        }

        .file-preview-container {
            display: flex; gap: 10px; padding: 0 10px 10px;
            overflow-x: auto; display: none;
        }
        .file-preview-item {
            position: relative; width: 60px; height: 60px;
            border-radius: 6px; overflow: hidden; border: 1px solid #555;
        }
        .file-preview-item img { width: 100%; height: 100%; object-fit: cover; }
        .remove-file {
            position: absolute; top: 0; right: 0;
            background: rgba(0,0,0,0.7); color: white;
            border: none; font-size: 12px; cursor: pointer; width: 20px; height: 20px;
            display: flex; align-items: center; justify-content: center;
        }

        .input-wrapper {
            position: relative; background-color: var(--input-bg);
            border-radius: 16px; border: 1px solid rgba(0,0,0,0.2);
            padding: 8px 10px 8px 45px; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            display: flex; align-items: flex-end; gap: 10px;
        }

        .attach-btn {
            position: absolute; left: 8px; bottom: 8px;
            background: none; border: none; color: #8e8ea0;
            cursor: pointer; padding: 5px; transition: 0.2s;
        }
        .attach-btn:hover { color: #ececf1; }

        textarea {
            width: 100%; background: transparent; border: none;
            color: white; font-size: 16px; resize: none;
            height: 24px; max-height: 150px; padding: 2px 0;
            font-family: inherit; line-height: 1.5;
        }

        .send-btn {
            background: var(--green); border: none; color: white;
            cursor: pointer; width: 32px; height: 32px;
            border-radius: 6px; display: flex; align-items: center; justify-content: center;
            transition: 0.2s; flex-shrink: 0;
        }
        .send-btn:disabled { background: transparent; color: #555; }
    </style>
</head>
<body>

    <!-- OVERLAY & SIDEBAR -->
    <div class="overlay" onclick="toggleSidebar()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <span>Model Selector</span>
            <button onclick="toggleSidebar()" style="background:none;border:none;color:#aaa;cursor:pointer">âœ•</button>
        </div>
        <div class="model-list" id="modelList"></div>
    </div>

    <!-- MAIN APP -->
    <div class="main-view">
        <div class="top-bar">
            <button class="hamburger" onclick="toggleSidebar()">
                <span class="material-icons-round">menu</span>
            </button>
            <span style="font-weight:600; font-size:14px;" id="headerTitle">GPT 5.1</span>
            <div style="width:24px"></div>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="message assistant">
                <div class="avatar">ðŸ¤–</div>
                <div class="content">
                    <p>Hello! I am ready.</p>
                    <p>â€¢ Use the <b>Paperclip</b> to upload images (Vision) or text files.</p>
                    <p>â€¢ Use the <b>Menu</b> to switch between GPT, Gemini, o1/o3, and Image Generators.</p>
                </div>
            </div>
        </div>

        <div class="input-area">
            <div class="file-preview-container" id="filePreviewContainer"></div>
            <div class="input-wrapper">
                <input type="file" id="fileInput" style="display: none;" onchange="handleFileSelect(this)">
                <button class="attach-btn" onclick="document.getElementById('fileInput').click()">
                    <span class="material-icons-round" style="font-size:20px; transform: rotate(45deg);">attach_file</span>
                </button>
                <textarea id="userInput" placeholder="Message..." rows="1"></textarea>
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                    <span class="material-icons-round" style="font-size:18px;">arrow_upward</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const API_KEY = "5f767344fd80741fd393672402a31dbb";
        
        // --- MODEL DEFINITIONS ---
        const models = [
            // OpenAI GPT-5
            { id: "openai/gpt-5.1", name: "GPT 5.1", type: "text" },
            { id: "openai/gpt-5", name: "GPT 5", type: "text" },
            { id: "openai/gpt-5-mini", name: "GPT 5 Mini", type: "text" },
            { id: "openai/gpt-5-nano", name: "GPT 5 Nano", type: "text" },
            // OpenAI GPT-4
            { id: "openai/gpt-4.1", name: "GPT 4.1", type: "text" },
            { id: "openai/gpt-4.1-mini", name: "GPT 4.1 Mini", type: "text" },
            { id: "openai/gpt-4.1-nano", name: "GPT 4.1 Nano", type: "text" },
            { id: "openai/gpt-4o", name: "GPT 4o", type: "text" },
            { id: "openai/gpt-4o-mini", name: "GPT 4o Mini", type: "text" },
            { id: "openai/gpt-4", name: "GPT 4", type: "text" },
            // OpenAI O-Series
            { id: "openai/o1", name: "OpenAI o1", type: "text" },
            { id: "openai/o3", name: "OpenAI o3", type: "text" },
            // OpenAI GPT-3.5
            { id: "openai/gpt-3.5-turbo", name: "GPT 3.5 Turbo", type: "text" },
            { id: "openai/gpt-3.5-turbo-16k", name: "GPT 3.5 Turbo 16k", type: "text" },
            { id: "openai/gpt-3.5-turbo-1106", name: "GPT 3.5 Turbo (1106)", type: "text" },
            // Google Gemini
            { id: "google/gemini-3-pro-preview", name: "Gemini 3 Pro", type: "text" },
            { id: "google/gemini-2.5-pro", name: "Gemini 2.5 Pro", type: "text" },
            { id: "google/gemini-2.5-flash", name: "Gemini 2.5 Flash", type: "text" },
            { id: "google/gemini-2.5-flash-lite", name: "Gemini 2.5 Flash Lite", type: "text" },
            // Image Generation
            { id: "google/imagen-4.0-ultra-generate-001", name: "Imagen 4 Ultra", type: "img" },
            { id: "google/imagen-4.0-generate-001", name: "Imagen 4", type: "img" },
            { id: "google/imagen-4.0-fast-generate-001", name: "Imagen 4 Fast", type: "img" },
            { id: "openai/dall-e-3", name: "DALL-E 3", type: "img" },
            { id: "dreamlike-art/dreamlike-photoreal-2.0", name: "Dreamlike Photo", type: "img" }
        ];

        let currentModel = models[0];
        let messages = [];
        let currentAttachment = null;

        // --- INIT UI ---
        const modelList = document.getElementById('modelList');
        const chatContainer = document.getElementById('chatContainer');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const filePreviewContainer = document.getElementById('filePreviewContainer');

        // Populate Sidebar
        models.forEach(m => {
            const btn = document.createElement('button');
            btn.className = 'model-btn';
            if(m.id === currentModel.id) btn.classList.add('active');
            btn.innerHTML = `<span>${m.name}</span><span class="tag ${m.type}">${m.type === 'img' ? 'IMG' : 'TXT'}</span>`;
            btn.onclick = () => switchModel(m, btn);
            modelList.appendChild(btn);
        });

        function switchModel(model, btnElement) {
            currentModel = model;
            document.getElementById('headerTitle').innerText = model.name;
            document.querySelectorAll('.model-btn').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
            toggleSidebar();
            addMessageToUI('assistant', `Switched to **${model.name}**. Ready!`);
            messages = []; 
            currentAttachment = null;
            renderFilePreview();
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.querySelector('.overlay').classList.toggle('active');
        }

        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            checkSendButton();
        });

        function checkSendButton() {
            if(userInput.value.trim() === "" && !currentAttachment) {
                sendBtn.disabled = true;
                sendBtn.style.background = "transparent";
            } else {
                sendBtn.disabled = false;
                sendBtn.style.background = "#19c37d";
            }
        }

        // --- FILE HANDLING ---
        function handleFileSelect(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                currentAttachment = {
                    name: file.name,
                    data: e.target.result,
                    type: file.type.startsWith('image/') ? 'image' : 'file'
                };
                renderFilePreview();
                checkSendButton();
            };
            reader.readAsDataURL(file);
            input.value = "";
        }

        function renderFilePreview() {
            filePreviewContainer.innerHTML = '';
            if (currentAttachment) {
                filePreviewContainer.style.display = 'flex';
                const div = document.createElement('div');
                div.className = 'file-preview-item';
                div.innerHTML = currentAttachment.type === 'image' 
                    ? `<img src="${currentAttachment.data}"><button class="remove-file" onclick="removeAttachment()">Ã—</button>` 
                    : `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#444;font-size:24px;">ðŸ“„</div><button class="remove-file" onclick="removeAttachment()">Ã—</button>`;
                filePreviewContainer.appendChild(div);
            } else {
                filePreviewContainer.style.display = 'none';
            }
        }

        function removeAttachment() {
            currentAttachment = null;
            renderFilePreview();
            checkSendButton();
        }

        // --- SEND LOGIC ---
        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text && !currentAttachment) return;

            // UI
            let displayContent = text;
            if (currentAttachment) {
                displayContent = currentAttachment.type === 'image' 
                    ? `<img src="${currentAttachment.data}" style="max-width:200px; border-radius:6px; display:block; margin-bottom:5px;"> ${text}`
                    : `[File: ${currentAttachment.name}] ${text}`;
            }
            addMessageToUI('user', displayContent, true);
            
            userInput.value = "";
            userInput.style.height = "24px";
            const attachmentToSend = currentAttachment;
            removeAttachment();
            checkSendButton();

            // Payload Construction
            let bodyPayload = {};

            if (currentModel.type === 'img') {
                bodyPayload = { text: text };
            } else {
                let messageContent = text;
                if (attachmentToSend) {
                    if (attachmentToSend.type === 'image') {
                        messageContent = [
                            { type: "text", text: text },
                            { type: "image_url", image_url: { url: attachmentToSend.data } }
                        ];
                    } else {
                        messageContent = text + `\n\n[User uploaded file: ${attachmentToSend.name}]`;
                    }
                }

                messages.push({ role: "user", content: messageContent });
                
                // IMPORTANT: temperature: 1 for ALL text models to fix o1/o3 error
                bodyPayload = {
                    messages: messages,
                    stream: false,
                    params: { temperature: 1 } 
                };
            }
            
            const loadingId = addMessageToUI('assistant', '<span style="color:#888;">Thinking...</span>', true);

            try {
                const response = await fetch(`https://api.bytez.com/models/v2/${currentModel.id}`, {
                    method: 'POST',
                    headers: { 'Authorization': API_KEY, 'Content-Type': 'application/json' },
                    body: JSON.stringify(bodyPayload)
                });

                const data = await response.json();

                if (data.error) {
                    updateMessage(loadingId, "Error: " + data.error);
                } else {
                    let output = "No output";
                    if (currentModel.type === 'img' && data.output) {
                        const imgUrl = data.output;
                        updateMessage(loadingId, `<img src="${imgUrl}" onload="this.scrollIntoView()" alt="Generated Image" />`, true);
                        messages.push({ role: "assistant", content: "Image generated." });
                    } else {
                        output = data.output ? (data.output.content || data.output) : JSON.stringify(data);
                        updateMessage(loadingId, output);
                        messages.push({ role: "assistant", content: output });
                    }
                }
            } catch (error) {
                updateMessage(loadingId, "Network Error: " + error.message);
            }
        }

        // --- RENDER HELPERS ---
        function addMessageToUI(role, text, isHtml = false) {
            const div = document.createElement('div');
            div.className = `message ${role}`;
            const id = 'msg-' + Date.now();
            div.id = id;
            const contentHtml = isHtml ? text : marked.parse(text);
            div.innerHTML = `
                <div class="avatar">${role === 'assistant' ? 'ðŸ¤–' : 'U'}</div>
                <div class="content">${contentHtml}</div>
                <div class="msg-actions">
                    <button class="action-btn" onclick="copyToClipboard('${id}')"><span class="material-icons-round" style="font-size:16px;">content_copy</span></button>
                </div>
            `;
            chatContainer.appendChild(div);
            scrollToBottom();
            return id;
        }

        function updateMessage(id, newText, isHtml = false) {
            const msgRow = document.getElementById(id);
            if (msgRow) {
                const contentDiv = msgRow.querySelector('.content');
                if (isHtml) contentDiv.innerHTML = newText;
                else {
                    contentDiv.innerHTML = marked.parse(newText);
                    // Code Block Copy Feature
                    contentDiv.querySelectorAll('pre').forEach((pre) => {
                        const header = document.createElement('div');
                        header.className = 'code-header';
                        header.innerHTML = `<span>Code</span><button class="copy-code-btn"><span class="material-icons-round" style="font-size:14px;">content_copy</span> Copy</button>`;
                        const codeBlock = pre.querySelector('code');
                        header.querySelector('button').addEventListener('click', () => {
                            navigator.clipboard.writeText(codeBlock.innerText);
                            header.querySelector('button').innerHTML = `<span class="material-icons-round" style="font-size:14px;">check</span> Copied!`;
                            setTimeout(() => header.querySelector('button').innerHTML = `<span class="material-icons-round" style="font-size:14px;">content_copy</span> Copy`, 2000);
                        });
                        pre.insertBefore(header, codeBlock);
                        hljs.highlightElement(codeBlock);
                    });
                }
                scrollToBottom();
            }
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).querySelector('.content').innerText;
            navigator.clipboard.writeText(text);
        }

        function scrollToBottom() {
            setTimeout(() => chatContainer.scrollTop = chatContainer.scrollHeight, 50);
        }
    </script>
</body>
</html>
